project:
  team: infra
  metadata:
    name: kube-ci
    version: "1.0"
    staging:
      project: qubit-apps-eu-stg
      cluster: europe-west1
      externalAccess: cloudloadbalancer

kubernetes:
- id: kube-ci
  cpus: 0.01
  mem: 64
  instances: 1
  args:
  - "-config=/config/config.yaml"
  - "-github.appid=23811"
  - "-keyfile=/config/keyfile"
  - "-secretfile=/config/webhook-secret"
  - "-argo.ui.base=https://kube-ci-staging.qutics.com"
  ports:
    - name: webhook-http
      containerPort: 8080
    - name: http # this is atually in the other container
      containerPort: 8081
  livenessProbe:
    httpGet:
      path: /status
      port: webhook-http
    timeoutSeconds: 2
    initialDelaySeconds: 10
    periodSeconds: 1
  labels:
    dnsName: 'kube-ci-staging.qutics.com' 
    externalAccess: '{{ externalAccess }}'
  sidecars:
    oauth2proxy:
      cmd:
      - /config/start-oauth2.sh
      livenessProbe:
        httpGet:
          path: /ping
          port: 8081
          scheme: HTTP
        timeoutSeconds: 3
        failureThreshold: 10
      ports:
      - name: http
        containerPort: 8081
      mem: 64
      cpus: 0.01
